<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Filter</title>
</head>
<body>
    
    <h1>jeopardy</h1>
    
    
    <!-- ===============
    CHOOSE CATEGORY AND VALUE 
    =============== -->
    
    <section>
        <h3 class="score"></h3>
    </section>
    
    <!-- ===============
    CATEGORY CHOICE
    =============== -->
    
    <section class="categoryContainer hide">
        <form class="categoryChoice">
            <label for="worldCapitals">World Capitals</label>
            <input type="radio" name="category" value="78" id="worldCapitals" class="category">
    
            <label for="animals">Animals</label>
            <input type="radio" name="category" value="21" id="animals" class="category">
    
    
            <label for="musicalInstruments">Musical Instruments</label>
            <input type="radio" name="category" value="184" id="musicalInstruments" class="category">
    
            <label for="mythology">Mythology</label>
            <input type="radio" name="category" value="680" id="mythology" class="category">
    
            <label for="threeLetterWords">3-Letter Words</label>
            <input type="radio" name="category" value="105" id="threeLetterWords" class="category">
            <!-- ======= -->
            <label for="doubleTalk">Double Talk</label>
            <input type="radio" name="category" value="89" id="doubleTalk" class="category">
    
            <label for="nurseryRhymes">Nursery Rhymes</label>
            <input type="radio" name="category" value="37" id="nurseryRhymes" class="category">
    
            <label for="fruitsAndVegetables">Fruits and Vegetables</label>
            <input type="radio" name="category" value="777" id="fruitsAndVegetables" class="category">
    
            <label for="movies">Movies</label>
            <input type="radio" name="category" value="309" id="movies" class="category">
    
            <label for="music">Pop Music</label>
            <input type="radio" name="category" value="770" id="music" class="category">
    
            <input type="submit" value="Submit Choice" class="submitCategory">
        </form>
    </section>
    
    <!-- ===============
    VALUE CHOICE    
    =============== -->
    
    <section class="valueContainer hide">
        <form class="valueChoice">
            <label for="two">200</label>
            <input type="radio" name="value" value="200" id="two" class="value">
    
            <label for="four">400</label>
            <input type="radio" name="value" value="400" id="four" class="value">
    
            <label for="six">600</label>
            <input type="radio" name="value" value="600" id="six" class="value">
    
            <label for="eight">800</label>
            <input type="radio" name="value" value="800" id="eight" class="value">
    
            <label for="ten">1000</label>
            <input type="radio" name="value" value="1000" id="ten" class="value">
    
            <input type="submit" value="Submit Difficulty" class="submitDifficulty">
        </form>
    </section>
    
    <!-- ===============
    DISPLAY TITLE, VALUE AND QUESTION 
    =============== -->
    
    <section class="questionContainer hide">
        <h3 class="title"></h3>
        <h4 class="value"></h4>
        <h2 class="question"></h2>
        <h2 class="answer"></h2>
    </section>
    <!--remember to add hide class to answer container-->
    <section class="answerContainer hide">
        <form action="" class="answerForm">
            <!-- <input type="submit" value="Submit Answer" class="submitAnswer"> -->
        </form>
    </section>

    <script src='https://code.jquery.com/jquery-3.2.1.min.js' integrity='sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4='crossorigin='anonymous'></script>
    <script>
    
    app = {};
  
    app.score = 0;

    app.getClues = function (categoryID, valueID) {
        $.ajax({
            url: "http://jservice.io/api/clues",
            method: "GET",
            data: {
                count: 100,
                value: valueID,
                category: categoryID,
            }
        })
            .then((res) => {
                app.displayQuestion(res);
            });
    }

    // ==============
    // GETTING INFO FROM THE API
    // FOR THE RANDOM ANSWERS 
    // THAT MATCH THE CATEGORY
    // ==============

    app.getAnswers = function (categoryID) {
        $.ajax({
            url: "http://jservice.io/api/clues",
            method: "GET",
            data: {
                count: 100,
                category: categoryID
            }
        })
            .then((res) => {
                app.wrongAnswers(res, 6);
            });
    }

    // ===============
    // USER CHOOSES CATEGORY AND VALUE
    // ===============
    app.events = function () {

        $(".category").on("click", function () {
            app.userCategoryChoice = $(".category:checked").val();
        })

        // When user submits, hide Categories and show value choices 
        $(".submitCategory").on("click", function (e) {
            e.preventDefault();
            $(".categoryContainer").addClass("hide");
            $(".valueContainer").removeClass("hide");
        })

        // When user submits, store value 
        $(".value").on("click", function () {
            app.userValueChoice = $(".value:checked").val();
        })

        // When user submits value hide the value and show the random question
        $(".submitDifficulty").on("click", function (e) {
            e.preventDefault();
            $(".valueContainer").addClass("hide");
            $(".questionContainer").removeClass("hide");
            $(".answerContainer").removeClass("hide");
            app.getClues(app.userCategoryChoice, app.userValueChoice);
        })


    } // end of event function

    // ===============
    // DISPLAY RANDOM QUESTION BASED ON USER INPUT 
    // AND RANDOM ANSWERS BASED ON THE CATRGORY
    // USER PUT IN  
    // ===============


    app.displayQuestion = function (questions) {

        // ARE WE EVEN USING THIS ANYMORE?? DOESN'T LOOK LIKE IT
        // SHOULD WE BE USING GOODQUESTIONS TO APPEND INSTEAD OF QUESTIONS
        const goodQuestions = questions.filter((question) => {
            return question.invalid_count === null;
        })

        // get a random number and display a random question
        // based on that random number 
        let randomNum = Math.floor(Math.random() * goodQuestions.length);
        // append the random question in our index page 
        const title = $("<h3>").text(goodQuestions[randomNum].category.title);
        const value = $("<h4>").text(app.userValueChoice);
        const question = $("<h2>").text(goodQuestions[randomNum].question);

        // an array with the results from .....??????
        let result = [];

        // ===============
        // GETTING RANDOM ANSWERS 
        // FROM CATEGORY THE USER CHOSE 
        // ===============
        app.wrongAnswers = function (res, neededElements) {
            // filtering through the results of 
            //the second ajax call for answers
            const filteredAnswers = res.map((answer) => {
                return answer.answer;
            })

            // getting a random 10 ansswers from second ajax request 
            for (let i = 0; i < neededElements; i++) {
                result.push(filteredAnswers[Math.floor(Math.random() * res.length)]);
            }

            // using regex here
            let newAnswersWithoutRandomCharacters;
            let emptyArray = [];
            let re = /<\/?[\w\s="/.':;#-\/\?]+>|[\/\\:+="#]+/gi
            let answersWithoutRandomCharacters = result.forEach((item) => {
                newAnswersWithoutRandomCharacters = item.replace(re, '');
                emptyArray.push(newAnswersWithoutRandomCharacters)
                // console.log(newAnswersWithoutRandomCharacters);
            })

            // filter through answers to make sure they're unique 
            // and duplicates don't show up 
            let uniqueAnswers = new Set(emptyArray);
            uniqueAnswers.add(app.correctAnswer);
            console.log("These are unique answers in a Set");
            console.log(uniqueAnswers);

            // loop through new array of unique answers 
            // and append the answers in the array
            for (let answer of uniqueAnswers.values()) {
                // $(".answerContainer").append(`<input type ="radio" name="answers" value="${answer}" id="${answer}" class="answers"><label for="${answer}">${answer}</label>`)
            }

            // this takes the new Set and makes it into an array
            let backToRegArray = Array.from(uniqueAnswers);
            console.log("This is a regular array again");
            console.log(backToRegArray);

            // looping over regular array 
            // to make sure we only have 5 answers 
            for (let i = backToRegArray.length; i > 5; i--) {
                backToRegArray.pop();
            }

            // this randomizes the order of the array. 
            backToRegArray.sort(function (a, b) { return 0.5 - Math.random() });
            console.log("Array in random order");
            console.log(backToRegArray);

            // for every answer append it to the page 
            for (let answer of backToRegArray) {
                $(".answerForm").append(`<input type ="radio" name="answers" value="${answer}" id="${answer}" class="answers"><label for="${answer}">${answer}</label>`)

            }
            // appending the submit button 
            $(".answerForm").append(`<input type="submit" value="Submit Answer" class="submitAnswer">`);
            // grab the value of what they chose 
            // and compare to value of the correct answer 
            // if it matches score increase 

            $(".answers").on("click", function () {
                console.log("clicked on an answer")
                app.userValueChoice = $(".answers:checked").val();
                if (app.userValueChoice === app.correctAnswer) {
                    app.score = app.score + goodQuestions[randomNum].value;
                    $(".score").text(`${app.score}`);
                    console.log("right");
                    $(".answerForm").append("<p>Right!</p>")
                } else {
                    console.log("wrong");
                    $(".answerForm").append("<p>WRONG!!!!!</p>")

                }
            })

            $(".submitAnswer").on("click", function (e) {
                e.preventDefault();
                console.log("clicked submit button");
                $(".questionContainer").addClass("hide").empty();
                $(".answerForm").empty();
                $(".answerContainer").addClass("hide")
                $(".categoryContainer").removeClass("hide");
            })

        } // end of wrong answers function 

        // ===============
        // DISPLAY CORRECT ANSWERS 
        // FROM CATEGORY THE USER CHOSE
        // ===============
        app.correctAnswer;
        const displayAnswers = function () {
            // this is the correct answer 
            app.correctAnswer = goodQuestions[randomNum].answer;
            console.log("This is the right answer");
            console.log(app.correctAnswer);

            // pushing the correct answer into result 
            result.push(app.correctAnswer);
            // calling app.getAnswers 
            // so we have the info from the API 
            app.getAnswers(app.userCategoryChoice);

        }


        $(".questionContainer").append(title, value, question);
        displayAnswers();
    } // end of displayQuestions function


    // ===============
    // INITIALIZE THE APP
    // ===============
    app.init = function () {
        app.events();
        $(".categoryContainer").removeClass("hide");
    }

    // ===============
    // DOC READY
    // ===============
    $(function () {
        app.init();
    });

    </script>
</body>
</html>